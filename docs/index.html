<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2025ë…„ ì¬ì‚°ì„¸(í† ì§€) ê³„ì‚°</title>

<!-- ğŸ”½ PWA: í…Œë§ˆ/ë§¤ë‹ˆí˜ìŠ¤íŠ¸/ì•„ì´ì½˜ -->
<meta name="theme-color" content="#0b5" />
<link rel="manifest" href="manifest.webmanifest?v=3">
<link rel="icon" href="./icon-192-v2.png" sizes="192x192" />
<link rel="apple-touch-icon" href="./icon-512-v2.png" />

<style>
:root{
  --bg:#ffffff; --card:#f8f9fa; --text:#0b1220; --text-sub:#4b5563;
  --brand:#0b5; --brand-weak:#e7fff2; --sum-bg:#e7fff2;
  --input-bg:#fffbe6; --line:#ddd; --shadow:rgba(0,0,0,.08);
  --icon:#334155;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;font-size:14.4px;line-height:1.65;}
body::before{content:"";position:fixed;inset:0;pointer-events:none;z-index:-1;background-image:radial-gradient(rgba(0,187,85,.08) 1px,transparent 1px);background-size:18px 18px;opacity:.14}

/* â–¶ ìƒë‹¨ ë°” */
.appbar{position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(8px);background:color-mix(in oklab,var(--bg) 90%,#000 10%);border-bottom:1px solid var(--line)}
.appbar .row{max-width:880px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:12px}
.brand{display:none}
.app-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-left:0;justify-content:flex-start}
.icon-btn{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:6px;border:1px solid var(--line);background:var(--card);color:#000;cursor:pointer;text-decoration:none;font-size:10px;font-weight:800;white-space:nowrap}
.icon-btn:hover{filter:brightness(1.04)}
/* â¬‡ ë²„íŠ¼ë³„ íŒŒìŠ¤í…” í†¤ */
.icon-btn--print  {background:#eaf2ff;border-color:#cfe0ff;}  /* ì—°í•œ í•˜ëŠ˜ */
.icon-btn--realty {background:#eaf7ee;border-color:#cfe8d8;}  /* ì—°í•œ ì´ˆë¡ */
.icon-btn--law    {background:#fdecec;border-color:#f4c6c6;}  /* ì—°í•œ í•‘í¬ */
.icon-btn--wetax  {background:#f5eee6;border-color:#e5d9c7;}  /* ì—°í•œ ë² ì´ì§€ */
.icon-btn--install{background:#efe9ff;border-color:#d9ccff;}  /* ì—°í•œ ë¼ë²¤ë” */

.ico-printer,.ico-floppy{display:inline-flex;align-items:center;justify-content:center}
.ico-printer{width:20px;height:20px}
.ico-floppy{width:18px;height:18px}
.ico-printer svg,.ico-floppy svg{width:100%;height:100%}
.ico-printer .st,.ico-floppy .st{fill:none;stroke:var(--icon);stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
.ico-floppy .fill{fill:var(--icon)}

/* Layout (âŸµ ì „ì²´ í­ ì¶•ì†Œ + ì¹´ë“œ ì¤‘ì•™ ì •ë ¬) */
.wrap{max-width:880px;margin:20px auto 90px;padding:0 16px}
.page-title{font-size:24px;font-weight:900;letter-spacing:-0.3px;margin:6px 0 14px 0;text-align:center}
.grid{display:grid;grid-template-columns:1fr;gap:16px}
.card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:22px;box-shadow:0 4px 12px var(--shadow);max-width:720px;margin:12px auto}
.header-row{display:flex;align-items:center;justify-content:space-between;gap:12px}
h2{font-size:14.4px;margin:0;letter-spacing:-0.2px}
h2 .unit{font-size:9.6px;font-weight:600;margin-left:6px;vertical-align:middle;color:#4b5563}
label{display:block;font-size:13.6px;color:#4b5563;margin-bottom:6px;letter-spacing:-0.2px}

/* Inputs */
input[type="text"],input.num,select{background:#fff;border:1px solid #ccc;color:#000;padding:12px 14px;border-radius:10px;outline:none;font-size:13.6px}
input.num{text-align:right;background:var(--input-bg)}
select{background:#fff}
input:focus,select:focus{border-color:#9db4ff;box-shadow:0 0 0 3px rgba(44,88,255,.15)}
#ë¶„ë¦¬_ìœ í˜•{letter-spacing:-0.25px;padding:8px 10px;font-size:13px;line-height:1.2}

/* â¬‡ ìˆ«ìë§Œ ì…ë ¥ì¹¸: ê¸°ì¡´ 80% â†’ 60% (min/maxë„ 20% ì¶•ì†Œ) */
#section-input .row3 input.num{
  width:60%;min-width:192px;max-width:272px;margin:0 auto;
}

/* Rows */
.row{display:grid;grid-template-columns:1fr;gap:12px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:720px){.row3{grid-template-columns:1fr 1fr}}
#section-input .row3, #section-input .row2{max-width:680px;margin:0 auto}

/* Buttons */
.btn{display:inline-flex;gap:6px;align-items:center;padding:12px 18px;background:var(--brand);border:1px solid var(--brand);color:#fff;border-radius:12px;cursor:pointer;font-weight:700;font-size:15.2px;text-decoration:none}
.btn:hover{filter:brightness(1.05)}
.btn-calc{font-size:12px;padding:8px 13px !important}
.actions{text-align:center}

/* Sum & Table */
.sum-box{background:#ffffff;border:1px solid #b8f3d1;border-radius:12px;padding:14px 16px;margin:10px auto 12px auto;box-shadow:0 4px 10px rgba(0,187,85,.08);display:grid;grid-template-columns:1fr;gap:10px;text-align:center;max-width:520px}
.sum-box .label{font-size:13.6px;color:#000;font-weight:700}
.sum-box .value{font-size:14.4px;font-weight:900}
.sum-box.half{width:100%;max-width:420px;margin:10px auto}
@media (max-width:720px){.sum-box.half{max-width:100%}}

.table{width:100%;border-collapse:collapse;margin:8px auto 0;font-size:12.8px;table-layout:fixed;max-width:640px}
.table th,.table td{padding:12px;border-bottom:1px solid var(--line);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.table thead th:first-child{text-align:center}
.table td.mono{font-weight:800;font-size:13.6px}
.th-center{text-align:center !important}
tfoot tr{background:var(--sum-bg);font-weight:900}
tfoot th.big{font-size:15.2px;text-align:center}
.sum-amount{font-size:14.4px !important;font-weight:900 !important;line-height:1.2}

.result-table{max-width:520px;margin:8px auto 0}
.result-table th,.result-table td{text-align:center}

/* Breakdown (í­ ë” ì¶•ì†Œ + ì¤‘ì•™) */
.break-wrap{max-width:720px;margin:10px auto 0}
.info-table td{white-space:normal}
.city-apply{display:inline-flex;align-items:center;gap:6px;font-size:11px;margin-left:6px;color:#2c58ff}
.city-apply input{accent-color:var(--brand)}

/* Toast */
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:120px;z-index:60;background:#111827;color:#fff;padding:10px 14px;border-radius:10px;font-size:14px;opacity:0;pointer-events:none;transition:opacity .25s,transform .25s}
.toast.show{opacity:1;pointer-events:auto}

/* âœ… Print: A4 ì„¸ë¡œ(í•œ í˜ì´ì§€) */
@media print{
  @page{size:A4 portrait;margin:8mm}
  html,body{height:auto}
  *{-webkit-print-color-adjust:exact;print-color-adjust:exact}
  body{font-size:10.5pt;line-height:1.45}
  .appbar{display:none !important}
  .wrap{width:180mm; margin:0 auto; padding:0}
  .page-title{font-size:14pt;margin:2mm 0 4mm;text-align:center}
  .card{box-shadow:none;padding:8px;margin:0 auto;border-color:#ddd;max-width:170mm}
  .row3,.row2{gap:6px}
  .table{max-width:160mm}
  .table th,.table td{padding:6px;font-size:10.5pt}
  .sum-box{margin:4px auto;padding:8px;max-width:90mm}
  .sum-box.half{max-width:90mm}
  .result-table{max-width:160mm;margin:4mm auto 0}
  .break-wrap{max-width:170mm}
  .toast{display:none !important}
}
</style>
</head>
<body>
<header class="appbar">
  <div class="row">
    <div class="brand"></div>
    <div class="app-actions">
      <!-- 1) ì¸ì‡„/ì €ì¥ -->
      <a class="icon-btn lg icon-btn--print" href="javascript:void(0)" onclick="openPrint()" title="ì¸ì‡„ / PDF ì €ì¥" aria-label="ì¸ì‡„ ë¯¸ë¦¬ë³´ê¸°">
        <span class="ico-printer" aria-hidden="true">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path class="st" d="M7 8V4h10v4M6 17H5a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v3a2 2 0 0 1 2 2h-1M7 14h10v6H7zM17 11h.01"/></svg>
        </span>
        <span class="ico-floppy" aria-hidden="true" style="margin-left:2px">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="3" width="18" height="18" rx="2" class="st"/><rect x="6" y="5.5" width="9" height="6" class="st"/><rect x="17" y="6.5" width="3" height="3" class="fill"/><line x1="6" y1="16.5" x2="18" y2="16.5" class="st"/></svg>
        </span>
      </a>
      <!-- 2) ì£¼íƒê³µì‹œê°€ê²© -->
      <a class="icon-btn lg icon-btn--realty" href="javascript:void(0)" onclick="openLookupNew()" title="ì£¼íƒê³µì‹œê°€ê²©" aria-label="ì£¼íƒê³µì‹œê°€ê²©">
        <span aria-hidden="true">ğŸ”</span> ì£¼íƒê³µì‹œê°€ê²©
      </a>
      <!-- 3) ì§€ë°©ì„¸ë²• -->
      <a class="icon-btn lg icon-btn--law" target="_blank" href="https://www.law.go.kr/LSW/lsSc.do?query=%EC%A7%80%EB%B0%A9%EC%84%B8%EB%B2%95" rel="noopener">
        <span aria-hidden="true">ğŸ”</span> ì§€ë°©ì„¸ë²•
      </a>
      <!-- 4) ìœ„íƒìŠ¤ -->
      <a class="icon-btn lg icon-btn--wetax" target="_blank" href="https://www.wetax.go.kr/etq/etp/epi/E070101M01.do" rel="noopener" title="ìœ„íƒìŠ¤ ì§€ë°©ì„¸ ë‚©ë¶€" aria-label="ìœ„íƒìŠ¤">
        <span aria-hidden="true">ğŸ§¾</span> ìœ„íƒìŠ¤
      </a>
      <!-- 5) ì•± ì„¤ì¹˜ -->
      <button id="install" type="button" class="icon-btn lg icon-btn--install">ì•± ì„¤ì¹˜</button>
    </div>
  </div>
</header>

<div class="wrap">

  <!-- í° ì œëª© -->
  <div class="page-title">2025ë…„ ì¬ì‚°ì„¸ ê³„ì‚°(í† ì§€)</div>

  <div class="grid">
    <!-- ì…ë ¥ -->
    <div class="card" id="section-input">
      <div class="header-row">
        <h2>1. í† ì§€ ê³¼ì„¸í‘œì¤€ ì…ë ¥<span class="unit">(ë‹¨ìœ„: ì›)</span></h2>
      </div>

      <div class="row3">
        <div>
          <label>ì¢…í•©í•©ì‚° ê³¼ì„¸í‘œì¤€</label>
          <input id="ê³¼í‘œ_ì¢…í•©" class="num" type="text" inputmode="numeric" placeholder="ìˆ«ìë§Œ ì…ë ¥">
        </div>
        <div>
          <label>ë³„ë„í•©ì‚° ê³¼ì„¸í‘œì¤€</label>
          <input id="ê³¼í‘œ_ë³„ë„" class="num" type="text" inputmode="numeric" placeholder="ìˆ«ìë§Œ ì…ë ¥">
        </div>
        <div>
          <label>ë¶„ë¦¬ê³¼ì„¸ ê³¼ì„¸í‘œì¤€</label>
          <input id="ê³¼í‘œ_ë¶„ë¦¬" class="num" type="text" inputmode="numeric" placeholder="ìˆ«ìë§Œ ì…ë ¥">
        </div>
      </div>

      <div class="row2" style="margin-top:8px">
        <div>
          <label>ë¶„ë¦¬ê³¼ì„¸ ìœ í˜• ì„ íƒ</label>
          <select id="ë¶„ë¦¬_ìœ í˜•">
            <option value="" selected disabled>ì„ íƒ</option>
            <option value="farm">ì „Â·ë‹µÂ·ê³¼ìˆ˜ì›Â·ëª©ì¥ìš©ì§€Â·ë™ í˜¸ ë‚˜ëª© ì„ì•¼ (0.07%)</option>
            <option value="golf">ê³¨í”„ì¥ìš© ë° ê³ ê¸‰ì˜¤ë½ì¥ìš© í† ì§€ (4%)</option>
            <option value="etc">ê¸°íƒ€í† ì§€ (0.2%)</option>
          </select>
        </div>
        <div></div>
      </div>

      <div class="actions" style="margin-top:10px">
        <button class="btn btn-calc" onclick="calc()">âœï¸ ê³„ì‚°í•˜ê¸°</button>
      </div>

      <!-- ì„¸ì•¡ì‚°ì¶œ ì •ë³´ (í­ ì¶•ì†Œ + êµ¬ë¶„ë³„ ë„ì‹œê³¼ì„¸ í† ê¸€) -->
      <div class="break-wrap">
        <details open>
          <summary>ì„¸ì•¡ì‚°ì¶œ ì •ë³´</summary>
          <table class="table info-table">
            <thead>
              <tr>
                <th class="th-center">êµ¬ë¶„</th>
                <th class="mono th-center">ì¬ì‚°ì„¸(ë³¸ì„¸)</th>
                <th class="mono th-center">ë„ì‹œì§€ì—­ë¶„</th>
                <th class="mono th-center">ì§€ë°©êµìœ¡ì„¸</th>
                <th class="mono th-center">í•©ê³„</th>
              </tr>
            </thead>
            <tbody id="tbBreak">
              <tr><td colspan="5" style="text-align:center;color:#555">ê³¼ì„¸í‘œì¤€ ì…ë ¥ í›„ â€˜ê³„ì‚°í•˜ê¸°â€™ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</td></tr>
            </tbody>
          </table>
        </details>
      </div>
    </div>

    <!-- ê²°ê³¼ -->
    <div class="card" id="section-result">
      <h2>2. ìµœì¢… ì„¸ì•¡</h2>

      <!-- í•©ê³„ ì„¸ì•¡ ë°•ìŠ¤(ë°˜í­) -->
      <div class="sum-box half" role="status" aria-live="polite">
        <div><div class="label">í•©ê³„ ì„¸ì•¡</div><div class="value" id="sumY_top">-</div></div>
      </div>

      <!-- ì„¸ëª©Â·ì´ì„¸ì•¡ í‘œë¥¼ ì¤‘ì•™ì— ë°°ì¹˜ -->
      <table class="table result-table">
        <thead><tr><th class="th-center">ì„¸  ëª©</th><th class="mono th-center">ì´ì„¸ì•¡</th></tr></thead>
        <tbody id="tb"><tr><td colspan="2" style="text-align:center;color:#555">ê³¼ì„¸í‘œì¤€ ì…ë ¥ í›„ â€˜ê³„ì‚°í•˜ê¸°â€™ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</td></tr></tbody>
        <tfoot><tr><th class="big th-center">í•©ê³„ ì„¸ì•¡</th><th class="mono sum-amount" id="sumY">-</th></tr></tfoot>
      </table>
    </div>

  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
/* ---------- ìœ í‹¸ ---------- */
const $=id=>document.getElementById(id);
const setText=(id,v)=>{const el=$(id); if(el) el.textContent=v;}
const setHTML=(id,v)=>{const el=$(id); if(el) el.innerHTML=v;}
const numOf=id=>Number((($(id)?.value)||'').replace(/,/g,'')||0);
const floor10=n=>Math.floor(n/10)*10;
const fmt=n=>(Number.isFinite(n)?Math.floor(n).toLocaleString('ko-KR')+'ì›':'-');
function toast(msg){const t=$('toast'); if(!t) return; t.textContent=msg; t.classList.add('show'); clearTimeout(toast._timer); toast._timer=setTimeout(()=>t.classList.remove('show'),1500);}

/* ì…ë ¥ ìˆ«ì ì½¤ë§ˆ (ê³„ì‚°ì€ ë²„íŠ¼ ëˆ„ë¥¼ ë•Œë§Œ) */
document.addEventListener('input',e=>{
  if(e.target.classList.contains('num')){
    let v=e.target.value.replace(/,/g,'').replace(/[^\d]/g,'');
    if(v===''){e.target.value='';return;}
    e.target.value=v.replace(/\B(?=(\d{3})+(?!\d))/g,",");
  }
});

/* ë°”ë¡œê°€ê¸° */
function openLookupNew(){window.open('https://www.realtyprice.kr/notice/town/nfSiteLink.htm','_blank','noopener');}

/* ---------- ì„¸ìœ¨í‘œ ---------- */
/* ì¢…í•©í•©ì‚° */
const BRACKETS_SUM = [
  {base:0,           rate:0.0020, minus:0},
  {base:50_000_000,  rate:0.0030, minus:50_000},
  {base:100_000_000, rate:0.0050, minus:250_000}
];
/* ë³„ë„í•©ì‚° */
const BRACKETS_SEP = [
  {base:0,            rate:0.0020, minus:0},
  {base:200_000_000,  rate:0.0030, minus:200_000},
  {base:1_000_000_000,rate:0.0040, minus:1_200_000}
];
/* ë¶„ë¦¬ê³¼ì„¸(3ì¢…) */
const RATE_SPLIT = {
  farm: 0.0007, // ì „Â·ë‹µÂ·ê³¼ìˆ˜ì›Â·ëª©ì¥ìš©ì§€Â·ë™ í˜¸ ë‚˜ëª© ì„ì•¼ 0.07%
  golf: 0.0400, // ê³¨í”„ì¥ìš© ë° ê³ ê¸‰ì˜¤ë½ì¥ìš© 4%
  etc:  0.0020  // ê¸°íƒ€í† ì§€ 0.2%
};

/* ë„ì‹œì§€ì—­ë¶„ / ì§€ë°©êµìœ¡ì„¸ */
const CITY_RATE = 0.0014;  // 0.14%
const EDU_RATE  = 0.20;    // ë³¸ì„¸ì˜ 20%

/* ê³µìš© í•¨ìˆ˜ */
function pickBracket(base, table){ let cur=table[0]; for(const b of table){ if(base>=b.base) cur=b; else break; } return cur; }
function taxByBracket(base, table){ if(!(base>0)) return 0; const r = pickBracket(base, table); return Math.floor(base*r.rate - r.minus); }

/* êµ¬ë¶„ë³„ ë„ì‹œê³¼ì„¸ ì ìš© ìƒíƒœ ì½ê¸°(ì—†ìœ¼ë©´ ê¸°ë³¸ê°’) */
function getCityFlags(splitType){
  const sum = document.getElementById('ck_city_sum')?.checked ?? true;
  const sep = document.getElementById('ck_city_sep')?.checked ?? true;
  // ë¶„ë¦¬ê³¼ì„¸ ê¸°ë³¸: 'golf'ë§Œ ì ìš©, ê·¸ ì™¸(farm/etc/ì„ íƒì•ˆí•¨)ëŠ” ë¯¸ì ìš©
  const splDefault = (splitType==='golf');
  const spl = document.getElementById('ck_city_spl')?.checked ?? splDefault;
  return {sum, sep, spl};
}

/* ---------- ê³„ì‚° (ë²„íŠ¼ í´ë¦­ ì‹œì—ë§Œ ì‹¤í–‰) ---------- */
function calc(){
  const baseSum   = numOf('ê³¼í‘œ_ì¢…í•©');
  const baseSep   = numOf('ê³¼í‘œ_ë³„ë„');
  const baseSplit = numOf('ê³¼í‘œ_ë¶„ë¦¬');
  const rawType   = ($('ë¶„ë¦¬_ìœ í˜•')?.value)||'';
  const splitType = (rawType==='') ? 'none' : rawType;

  const flags = getCityFlags(splitType);

  /* ë³¸ì„¸: ì¢…í•©í•©ì‚° + ë³„ë„í•©ì‚° + ë¶„ë¦¬ê³¼ì„¸(ì„ íƒ ì „ì´ë©´ 0%) */
  const y_sum  = taxByBracket(baseSum, BRACKETS_SUM);
  const y_sep  = taxByBracket(baseSep, BRACKETS_SEP);
  const rate   = RATE_SPLIT[splitType] || 0;
  const y_spl  = Math.floor(baseSplit * rate);
  const y_bon  = y_sum + y_sep + y_spl;

  /* ë„ì‹œì§€ì—­ë¶„(êµ¬ë¶„ë³„ ì ìš©) â€” ë¶„ë¦¬ê³¼ì„¸ ë¯¸ì„ íƒ ì‹œ ë¹„ê³¼ì„¸ */
  const city_sum = flags.sum ? Math.floor(baseSum  * CITY_RATE) : 0;
  const city_sep = flags.sep ? Math.floor(baseSep  * CITY_RATE) : 0;
  const city_spl = (rate>0 && flags.spl) ? Math.floor(baseSplit * CITY_RATE) : 0;
  const y_city   = city_sum + city_sep + city_spl;

  /* ì§€ë°©êµìœ¡ì„¸: ë³¸ì„¸ì˜ 20% â†’ ì‹­ì›ë‹¨ìœ„ ì ˆì‚¬ */
  const eduY10 = floor10(Math.floor(y_bon * EDU_RATE));

  /* í•©ê³„ ì‚°ì‹(ì£¼íƒ ê·œì¹™ê³¼ ë™ì¼) */
  const subtotalY10 = floor10(y_bon + y_city);
  const sumY = subtotalY10 + eduY10;   // ì—°ê°„ í•©ê³„(=ìµœì¢… í•©ê³„ ì„¸ì•¡)

  /* ë³¸ë¬¸ ê²°ê³¼ í‘œ (ì„¸ëª©Â·ì´ì„¸ì•¡) ì¤‘ì•™ ì •ë ¬ */
  const rows=[
    ['ì¬ì‚°ì„¸(ë³¸ì„¸)', fmt(y_bon)],
    ['ë„ì‹œì§€ì—­ë¶„',   fmt(y_city)],
    ['ì§€ë°©êµìœ¡ì„¸',   fmt(eduY10)]
  ].map(([n,y])=>`<tr><td class="th-center">${n}</td><td class="mono">${y}</td></tr>`).join('');
  setHTML('tb', rows);

  setText('sumY', fmt(sumY));
  setText('sumY_top', fmt(sumY));

  /* â–¼ ì„¸ì•¡ì‚°ì¶œ ì •ë³´(ê³¼ì„¸ì²´ê³„ë³„) â€” ìƒí•œ ì „ ê¸°ì¤€ + êµ¬ë¶„ë³„ ë„ì‹œê³¼ì„¸ í† ê¸€ */
  const edu_sum10 = floor10(Math.floor(y_sum * EDU_RATE));
  const edu_sep10 = floor10(Math.floor(y_sep * EDU_RATE));
  const edu_spl10 = floor10(Math.floor(y_spl * EDU_RATE));

  const sum_sum10 = floor10(y_sum + city_sum) + edu_sum10;
  const sum_sep10 = floor10(y_sep + city_sep) + edu_sep10;
  const sum_spl10 = floor10(y_spl + city_spl) + edu_spl10;

  const labelSum = `ì¢…í•©í•©ì‚° <label class="city-apply"><input type="checkbox" id="ck_city_sum" ${flags.sum?'checked':''}> ë„ì‹œê³¼ì„¸</label>`;
  const labelSep = `ë³„ë„í•©ì‚° <label class="city-apply"><input type="checkbox" id="ck_city_sep" ${flags.sep?'checked':''}> ë„ì‹œê³¼ì„¸</label>`;
  const labelSpl = `ë¶„ë¦¬ê³¼ì„¸ <label class="city-apply"><input type="checkbox" id="ck_city_spl" ${flags.spl?'checked':''}> ë„ì‹œê³¼ì„¸</label>`;

  const breakdownRows = [
    [labelSum, fmt(y_sum), fmt(city_sum), fmt(edu_sum10), fmt(sum_sum10)],
    [labelSep, fmt(y_sep), fmt(city_sep), fmt(edu_sep10), fmt(sum_sep10)],
    [labelSpl, fmt(y_spl), fmt(city_spl), fmt(edu_spl10), fmt(sum_spl10)]
  ].map(([g,bon,city,edu,sum])=>
    `<tr>
       <td class="th-center">${g}</td>
       <td class="mono" style="text-align:right">${bon}</td>
       <td class="mono" style="text-align:right">${city}</td>
       <td class="mono" style="text-align:right">${edu}</td>
       <td class="mono" style="text-align:right">${sum}</td>
     </tr>`
  ).join('');
  setHTML('tbBreak', breakdownRows);

  // í† ê¸€ ë¦¬ìŠ¤ë„ˆ ë¶€ì°© â†’ ë³€ê²½ ì¦‰ì‹œ ì¬ê³„ì‚°
  ['ck_city_sum','ck_city_sep','ck_city_spl'].forEach(id=>{
    const el=document.getElementById(id);
    if(el && !el._bound){ el.addEventListener('change', calc); el._bound=true; }
  });
}

/* ì¸ì‡„/ì €ì¥ â€” ë¸Œë¼ìš°ì € ë¯¸ë¦¬ë³´ê¸°(ì„¸ë¡œ 1í˜ì´ì§€ ë ˆì´ì•„ì›ƒ) */
function openPrint(){ window.print(); }
</script>

<!-- PWA: ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ + ì„¤ì¹˜ ë²„íŠ¼ ë™ì‘ -->
<script>
(function(){
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js').catch(console.error);
  }
  // ì•± ì„¤ì¹˜ ë²„íŠ¼
  let deferredPrompt;
  const btn = document.getElementById('install');
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault(); deferredPrompt = e; if (btn) btn.style.display = 'inline-flex';
  });
  if (btn) {
    btn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      btn.disabled = true; deferredPrompt.prompt();
      await deferredPrompt.userChoice;
      deferredPrompt = null; btn.style.display = 'none';
    });
  }
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
  if (isStandalone && btn) btn.style.display = 'none';
})();
</script>
</body>
</html>
LSH
